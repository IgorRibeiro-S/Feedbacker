<template>
  <div class="box animate__animated animate__fadeInUp animate__faster">
    <div
      class="relative w-full flex"
      :class="{
        'justify-between': canShowAdditionalControlAndInfo,
        'justify-end': !canShowAdditionalControlAndInfo
      }">
      <button
      v-if="canShowAdditionalControlAndInfo"
      @click="back"
      :disabled="canGoBack"
      :class="{ invisible: canGoBack }"
      class="text-xl text-gray-800 focus:outline-none"
      >
      <svg
      width="20"
      height="10"
      viewBox="0 0 13 5"
      fill="none"
      xmlns="http://www.w3.org/2000/svg">
        <path d="M3.07415 3.21819L12.3158 3.23798L12.3183 2.06329L3.07666 2.04351L3.08044 0.281483L0.00512019 2.62427L3.07038 4.98021L3.07415 3.21819Z" fill="#9D9D9D"/>
      </svg>

      </button>
      <p
        v-if="canShowAdditionalControlAndInfo"
        class="text-xl font-black text-brand-main text-center">
        {{ label }}
      </p>
      <button
        @click="() => emit('close-box')"
        class="text-2xl text-gray-800 focus:outline-none">
        &times;
      </button>
    </div>
    <WizardView />
    <div class="text-gray-800 text-sm flex" v-if="canShowAdditionalControlAndInfo">
      <span class="mr-3 mt-1">
        <svg width="15"
            height="13"
            viewBox="0 0 15 13"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M12.4991 4.9352C12.4991 2.06815 9.53046 0 6.2494 0C2.94904 0 0 2.08406 0 4.9352C0.00290576 5.949 0.379738 6.9301 1.06556 7.70942C1.09479 8.61156 0.534434 9.90794 0.0275766 10.8482C1.38241 10.6171 3.30919 10.1048 4.18226 9.59845C8.99355 10.7074 12.4991 7.91905 12.4991 4.9352ZM3.43714 5.75104C3.28266 5.75088 3.1317 5.70743 3.00333 5.62617C2.87497 5.54491 2.77496 5.42949 2.71596 5.29451C2.65695 5.15952 2.6416 5.01102 2.67184 4.86779C2.70208 4.72456 2.77655 4.59301 2.88584 4.48979C2.99513 4.38656 3.13434 4.31629 3.28586 4.28785C3.43739 4.25941 3.59443 4.27408 3.73713 4.33001C3.87984 4.38595 4.0018 4.48062 4.08761 4.60208C4.17342 4.72353 4.21922 4.86631 4.21922 5.01238C4.219 5.20835 4.1365 5.39623 3.98986 5.53474C3.84322 5.67324 3.64442 5.75104 3.43714 5.75104ZM6.24995 5.75104C6.09547 5.75088 5.94451 5.70743 5.81614 5.62617C5.68778 5.54491 5.58777 5.42949 5.52877 5.29451C5.46977 5.15952 5.45441 5.01102 5.48465 4.86779C5.51489 4.72456 5.58936 4.59301 5.69865 4.48979C5.80794 4.38656 5.94715 4.31629 6.09867 4.28785C6.2502 4.25941 6.40724 4.27408 6.54994 4.33001C6.69265 4.38595 6.81461 4.48062 6.90042 4.60208C6.98623 4.72353 7.03203 4.86631 7.03203 5.01238C7.03195 5.10947 7.01165 5.2056 6.97228 5.29527C6.9329 5.38494 6.87523 5.4664 6.80256 5.535C6.72988 5.60359 6.64362 5.65798 6.54871 5.69505C6.4538 5.73211 6.35209 5.75114 6.2494 5.75104H6.24995ZM9.06277 5.75104C8.90825 5.75104 8.7572 5.70772 8.62873 5.62655C8.50025 5.54539 8.40012 5.43002 8.34099 5.29505C8.28186 5.16008 8.26639 5.01156 8.29653 4.86827C8.32668 4.72498 8.40108 4.59337 8.51034 4.49006C8.6196 4.38676 8.75881 4.31641 8.91035 4.28791C9.0619 4.2594 9.21898 4.27403 9.36173 4.32994C9.50449 4.38585 9.6265 4.48052 9.71235 4.602C9.79819 4.72347 9.84401 4.86628 9.84401 5.01238C9.84394 5.10945 9.82364 5.20555 9.78429 5.29521C9.74493 5.38486 9.68728 5.46631 9.61464 5.5349C9.54199 5.6035 9.45576 5.65789 9.36088 5.69497C9.266 5.73206 9.16433 5.75111 9.06166 5.75104H9.06277ZM13.4601 6.6026C13.3597 6.89086 13.234 7.17072 13.0845 7.4393C14.1324 8.185 14.4948 9.34553 13.3744 10.6093C13.3614 11.0497 13.3438 11.2291 13.4607 11.7114C12.9031 11.5289 12.8488 11.4797 12.4202 11.2309C11.0907 11.5375 9.75466 11.6424 8.61465 10.7259C8.25759 10.8201 7.89436 10.8919 7.5273 10.941C8.4729 12.0499 10.2135 12.6527 12.2625 12.1818C12.8339 12.5132 14.0955 12.8477 14.9824 13C14.6514 12.3826 14.2844 11.5352 14.3023 10.9444C15.3982 9.70483 15.2656 7.73237 13.459 6.6026H13.4601Z" fill="black" fill-opacity="0.53"/>
        </svg>
      </span>
        widget by
      <span class="ml-1 font-bold"  >
        feedbacker
      </span>
    </div>
  </div>
</template>
<script lang="ts">
import { defineComponent, computed, ComputedRef, SetupContext } from 'vue'
import WizardView from '../../components/wizard/WizardView.vue'
import useStore from '../../hooks/store'
import useNavigation from '../../hooks/navigation'

interface SetupReturn {
  emit: SetupContext['emit'];
  back(): void;
  canGoBack: ComputedRef<boolean>;
  label: ComputedRef<string>;
  canShowAdditionalControlAndInfo: ComputedRef<boolean>;
}

export default defineComponent({
  components: {
    WizardView
  },
  emit: ['close-box'],
  setup (_, { emit }: SetupContext) : SetupReturn {
    const store = useStore()
    const { back } = useNavigation()

    const label = computed<string>(() => {
      if (store.feedbackType === 'ISSUE') {
        return 'Reporte um problema'
      }
      if (store.feedbackType === 'IDEA') {
        return 'Nos fale a sua ideia'
      }
      if (store.feedbackType === 'OTHER') {
        return 'Abra sua mente'
      }

      return 'O que vocÃª tem em mente?'
    })
    const canGoBack = computed<boolean>(() => {
      return store.currentComponent === 'SelectFeedbackType'
    })
    const canShowAdditionalControlAndInfo = computed<boolean>(() => {
      return store.currentComponent !== 'SuccessView' && store.currentComponent !== 'ErrorView'
    })
    return {
      emit,
      back,
      canGoBack,
      canShowAdditionalControlAndInfo,
      label
    }
  }
})
</script>
<style lang="postcss" scoped>
.box {
  @apply fixed z-50 bottom-0 right-0 mb-5 mr-5 bg-white rounded-xl py-3 px-5 flex items-center shadow-xl select-none flex-col;
  width: 400px;
}
</style>
